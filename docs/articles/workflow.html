<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow • medslcleaner</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Workflow">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medslcleaner</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/workflow.html">Workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Workflow</h1>
            
      
      
      <div class="hidden name"><code>workflow.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>This is a typical workflow for processing election returns:</p>
<ol style="list-style-type: decimal">
<li>Read from the disk returns collected from states or administrative jurisdictions in assorted format</li>
<li>Shuffle the data around to match our schema</li>
<li>Standardize certain values that refer to candidate names, federal or state legislative office, or party</li>
<li>Assign observations to one of our releases (e.g., the <a href="https://dataverse.harvard.edu/dataverse/medsl_house">U.S. House dataverse</a>)</li>
<li>Add state, county, and candidate identifiers</li>
<li>Check for data quality issues</li>
<li>Save the result</li>
</ol>
<p>The sections that follow describe package functionality for each step and offer some guidance.</p>
<div id="read-returns" class="section level3">
<h3 class="hasAnchor">
<a href="#read-returns" class="anchor"></a>Read returns</h3>
<div id="csv" class="section level4">
<h4 class="hasAnchor">
<a href="#csv" class="anchor"></a>CSV</h4>
<p>Column <em>type</em> problems often arise when reading returns from delimited text (e.g., CSV) files. We also may encounter column names that are duplicated, missing, or contain special characters. Base R’s <code>read.csv</code> doesn’t handle these situations as safely as <code>fread</code> from <code>data.table</code> and <code>read_csv</code> from <code>readr</code>.</p>
<p><code>fread</code> and <code>read_csv</code> produce warnings on parser errors that we can resolve by setting column types explicitly via the <code>colClasses</code> argument for <code>fread</code> or <code>col_types</code> for <code>read_*</code>. Other than the two functions’ return types, <code>data.table</code> and <code>tibble</code>, the most relevant difference in implementation for us is that the <code>read_</code> family infers column types from the first <code>guess_max</code> rows, whereas <code>fread</code> uses a sample.</p>
<p>We’d ideally read returns from a delimited-text format only once, and for any intermediate writes to the disk during processing use a binary format that preserves types, e.g. an R data format. But we haven’t always done this, and in the 2016 returns there are a lot of intermediate CSVs.</p>
<p>Read these intermediate CSVs with the <code>read_legacy_csv</code> function. It promotes parser warnings to errors, and can read expected columns with the appropriate types if <code>use_types = TRUE</code>.</p>
</div>
<div id="excel" class="section level4">
<h4 class="hasAnchor">
<a href="#excel" class="anchor"></a>Excel</h4>
<p>We deal with quite a few Excel files. Some can be handled with the <a href="http://readxl.tidyverse.org">readxl</a> package. It works well when spreadsheets already look like sane tabular data, with a single header row followed by observations whose identifiers are in columns.</p>
<p>This isn’t always so. Consider an excerpt:</p>
<div class="figure">
<img src="excel-example.png" alt="Excel Example"><p class="caption">Excel Example</p>
</div>
<p>The top of the sheet has three headers, which give:</p>
<ul>
<li>Elected office (“United States President,” more values to the right not shown) in rows <code>1:3</code>
</li>
<li>Candidate party (“IND”, “DEM”, …) in row <code>4</code>
</li>
<li>Candidate name (“Darrell L. Castle”, “Hillary Rodham Clinton”, …) in row <code>5</code>
</li>
</ul>
<p>But there’s also an interstitial header spanning <code>A6:I6</code> (“ADA”). This is a jurisdiction, and describes all the rows below it until the next such header. (Which happens to be “ADA (Continued)” in <code>A31:I31</code>). These headers appear about every 25 rows. Otherwise, <code>A</code> gives precinct numbers.</p>
<p>At a high level, we want to do the following:</p>
<ol style="list-style-type: decimal">
<li>Associate each <code>office</code>, <code>party</code> and <code>candidate</code> in <code>B:I</code> with the votes in its column;</li>
<li>Associate each <code>jurisdiction</code> in <code>A</code> with all the votes below it, until the next interstitial header;</li>
<li>Associate each <code>precinct</code> in <code>A</code> with all the votes in its row;</li>
<li>Avoid including total rows (not shown above).</li>
</ol>
<p>The desired result would start like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">                    office party              candidate jurisdiction precinct votes</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="dv">1</span><span class="op">:</span><span class="st"> </span>UNITED STATES PRESIDENT   IND      Darrell L. Castle          ADA     <span class="dv">1401</span>     <span class="dv">4</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="dv">2</span><span class="op">:</span><span class="st"> </span>UNITED STATES PRESIDENT   DEM Hillary Rodham Clinton          ADA     <span class="dv">1401</span>   <span class="dv">206</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="dv">3</span><span class="op">:</span><span class="st"> </span>UNITED STATES PRESIDENT   CON         Scott Copeland          ADA     <span class="dv">1401</span>     <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="dv">4</span><span class="op">:</span><span class="st"> </span>UNITED STATES PRESIDENT   IND     Rocky De La Fuente          ADA     <span class="dv">1401</span>     <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="dv">5</span><span class="op">:</span><span class="st"> </span>UNITED STATES PRESIDENT   LIB           Gary Johnson          ADA     <span class="dv">1401</span>    <span class="dv">35</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="dv">6</span><span class="op">:</span><span class="st"> </span>UNITED STATES PRESIDENT   IND          Evan McMullin          ADA     <span class="dv">1401</span>    <span class="dv">63</span></a></code></pre></div>
<p>The package includes functionality for arriving at such a result with reasonable speed and safely. See the vignette on Excel-file processing for more details.</p>
</div>
</div>
<div id="shuffle-data" class="section level3">
<h3 class="hasAnchor">
<a href="#shuffle-data" class="anchor"></a>Shuffle data</h3>
<p>Each row in released precinct data gives the <code>votes</code> cast via some <code>mode</code> (e.g., by mail) for a <code>candidate</code> running for an <code>office</code> either on a <code>party</code> line or as a <code>writein</code>, in a particular <code>precinct</code> within an election <code>jurisdiction</code>. So, observations should be unique by <code>jurisdiction</code>, <code>precinct</code>, <code>candidate</code>, <code>office</code>, <code>party</code>, <code>writein</code> and <code>mode</code>.</p>
<p>We wrangle the raw data into these columns. For most states this requires at minimum splitting a single raw column between <code>jurisdiction</code> and <code>precinct</code>, and another between <code>office</code> and <code>district</code>.</p>
<p>For readable and maintainable code, we recommend using the <code>stringr</code> package for this, in combination with either <code>dplyr</code> or <code>data.table</code>. There is some syntactic sugar in the package for text-value wrangling with regular expressions.</p>
<p>These infix operators are vectorized over a left-hand-side character vector and apply a pattern from their right-hand side (ignoring case). They correspond with functions in <code>stringr</code>:</p>
<table class="table">
<thead><tr class="header">
<th align="center">function</th>
<th align="left">stringr verb</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code>%=%</code></td>
<td align="left">detect</td>
</tr>
<tr class="even">
<td align="center"><code>%-%</code></td>
<td align="left">remove_all</td>
</tr>
<tr class="odd">
<td align="center"><code>%e%</code></td>
<td align="left">extract</td>
</tr>
</tbody>
</table>
<p>These functions operate on specified columns of a <code>data.table</code>:</p>
<table class="table">
<thead><tr class="header">
<th align="center">function</th>
<th align="left">operation</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><code>move</code></td>
<td align="left">extract then remove</td>
</tr></tbody>
</table>
</div>
<div id="standardize-values" class="section level3">
<h3 class="hasAnchor">
<a href="#standardize-values" class="anchor"></a>Standardize values</h3>
<p>We standardize certain values of <code>office</code> and <code>candidate</code>. For example, in MEDSL data, all presidential candidates run for the <code>office</code> of <code>US President</code>; to achieve this consistency we replace alternative references to the presidency.</p>
<div id="office" class="section level4">
<h4 class="hasAnchor">
<a href="#office" class="anchor"></a>office</h4>
<p>The standardized values of <code>office</code> are <code>US President</code>, <code>US Senate</code>, <code>US House</code>, <code>State Senate</code>, <code>State House</code>, and <code>Governor</code>. Other values are left as they appear in the raw data. In the future, this might change. See the <code>normalize_office</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(medslcleaner)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">d =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">office =</span> <span class="st">'President and Vice President of the United States'</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">candidate =</span> <span class="st">'Write-ins'</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw"><a href="../reference/normalize_office.html">normalize_office</a></span>(d)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">##          office candidate</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">## 1: US President Write-ins</a></code></pre></div>
</div>
<div id="candidate" class="section level4">
<h4 class="hasAnchor">
<a href="#candidate" class="anchor"></a>candidate</h4>
<p>We standardize presidential candidate names. Typically this is a one-liner using <code>normalize_presidential_candidates</code>, which searches for known candidate last names where <code>office</code> is <code>US President</code> and assigns the standardized form.</p>
<p>Generally, we want to standardize candidates’ names across all the jurisdictions in which they appear on the ballot. In practice, candidate names appear consistently at least within jurisdictions, and usually within states.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">d =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">office =</span> <span class="kw">c</span>(<span class="st">'US President'</span>),</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">candidate =</span> <span class="kw">c</span>(<span class="st">'TRUMP'</span>, <span class="st">'CLINTON'</span>))</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw"><a href="../reference/normalize_presidential_candidates.html">normalize_presidential_candidates</a></span>(d)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">##          office       candidate</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">## 1: US President    Donald Trump</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">## 2: US President Hillary Clinton</a></code></pre></div>
</div>
<div id="party" class="section level4">
<h4 class="hasAnchor">
<a href="#party" class="anchor"></a>party</h4>
<p>We standardize the names of parties where it seems useful. Exactly how could change in the future, but we use <code><a href="../reference/normalize_party.html">expand_party_abbr()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">d =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">party =</span> <span class="kw">c</span>(<span class="st">'DEM'</span>, <span class="st">'REP'</span>))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="../reference/normalize_party.html">expand_party_abbr</a></span>(d<span class="op">$</span>party)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">## [1] "democratic" "republican"</a></code></pre></div>
</div>
</div>
<div id="assign-dataverses" class="section level3">
<h3 class="hasAnchor">
<a href="#assign-dataverses" class="anchor"></a>Assign dataverses</h3>
<p>The <code>dataverse</code> variable takes one of these values: <code>president</code>, <code>senate</code>, <code>house</code>, <code>state</code>, <code>local</code>, and <code>all</code>. These values determine the dataverse into which we’ll release the data.</p>
<p>To assign standardized offices to their dataverses use <code>assign_fixed</code>. If <code>office</code> is <code>US President</code>, <code>dataverse</code> will be set to <code>president</code>, and so forth for <code>US Senate</code>, <code>US House</code>, <code>State Senate</code>, and <code>State House</code>.</p>
<p>Then use the <code>dvna</code> function to show the offices not yet assigned to a dataverse. The output also gives the number of jurisdictions in which they appeared on the ballot. Where it’s unclear whether an office is state or local, this can be a useful heuristic.</p>
<p>The <code>ogrep</code> function is similar but only shows offices that match a (regular-expression, case-insensitive) <code>pattern</code>. Develop an <code>ogrep</code> <code>pattern</code> that matches the desired offices, then use this pattern with the <code>assign_match</code> function to assign all rows with matching <code>office</code> values to a given <code>dataverse</code>.</p>
<p>We iterate over these steps until all offices have been assigned to dataverses, and <code>dvna</code> no longer produces an error.</p>
<p>First assign standardized offices:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">d =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">office =</span> <span class="kw">c</span>(<span class="st">'US House'</span>, <span class="st">'County Commissioner'</span>), <span class="dt">jurisdiction =</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="kw">c</span>(<span class="st">'Appleton'</span>, <span class="st">'Racine'</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">d</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">##                office jurisdiction</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">## 1            US House     Appleton</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">## 2 County Commissioner       Racine</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">d =<span class="st"> </span><span class="kw"><a href="../reference/assign_fixed.html">assign_fixed</a></span>(d)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">d</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">##                 office jurisdiction dataverse</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">## 1:            US House     Appleton     house</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">## 2: County Commissioner       Racine      &lt;NA&gt;</a></code></pre></div>
<p><code>dvna</code> would now show unassigned offices and stop. To assign them to dataverses:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># We test out a pattern that matches some number of the `office` values</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="../reference/ogrep.html">ogrep</a></span>(d, <span class="st">'County'</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">##                 office n_j   dv</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">## 1: County Commissioner   1 &lt;NA&gt;</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co"># Then assign matching rows a given `dataverse` value, in this case `local`</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">d =<span class="st"> </span><span class="kw"><a href="../reference/assign_match.html">assign_match</a></span>(d, <span class="st">'County'</span>, <span class="st">'local'</span>)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">d</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">##                 office jurisdiction dataverse</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">## 1:            US House     Appleton     house</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">## 2: County Commissioner       Racine     local</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co"># `dvna` no longer produces an error because all rows have a `dataverse`;</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co"># Leave it in the script here, as confirmation this remains true</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="kw"><a href="../reference/dvna.html">dvna</a></span>(d)</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">## Empty data.table (0 rows) of 1 col: office</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">## [1] TRUE</a></code></pre></div>
</div>
<div id="add-geo-ids" class="section level3">
<h3 class="hasAnchor">
<a href="#add-geo-ids" class="anchor"></a>Add geo IDs</h3>
<p>Before saving the result, we attach state and county identifiers from package datasets. In most states, <code>jurisdiction</code> values are county names, and in some, municipalities (notable exceptions are Alaska and DC). We map <code>jurisdiction</code> values to county or county-equivalent FIPS codes using the EAVS dataset (primarily), the tabular data included with the 2018 Census Partnership Shapefiles of voting districts, and 2017 Census gazetteers.</p>
<p>The function <code><a href="../reference/add_jurisdiction_fips.html">add_jurisdiction_fips()</a></code> will try to match jurisdictions by name with EAVS data, and if all jurisdictions can be found in the EAVS data, will merge in the corresponding county FIPS codes. In some states, more work is required; see for example the scripts for Vermont or Wisconsin.</p>
<p>Given county FIPS codes, we use <code>add_geo_ids</code> to join other county identifiers from the <code>county_ids</code> dataset in the <code>elections</code> package.</p>
</div>
<div id="add-candidate-ids" class="section level3">
<h3 class="hasAnchor">
<a href="#add-candidate-ids" class="anchor"></a>Add candidate IDs</h3>
<p>The <code>medslcleaner</code> package includes a <code>candidates</code> dataset with various identifiers for (at this point only) federal candidates, pulled from the FEC and the <span class="citation">@unitedstates</span> project. Linking ballot names to these datasets is already done, so merging in the identifiers only requires a call to <code>add_candidate_ids</code>.</p>
<p>If this fails, then the <code>candidates</code> dataset needs to be rebuilt to include new candidates; see the <code>data-ext/candidates</code> directory. In the future this should be more robust.</p>
</div>
<div id="save-the-result" class="section level3">
<h3 class="hasAnchor">
<a href="#save-the-result" class="anchor"></a>Save the result</h3>
<p>We use <code>write_precincts</code> to write the final result to disk. This function makes final normalizing adjustments to the data, and then checks it against our expectations about which variables exist and the values they take. These criteria are given in a package dataset called <code>precinct_validity</code>.</p>
<p>For example, there must exist in the data a variable <code>state_postal</code> of type <code>character</code>, which takes a single non-missing value for all observations; it can’t be missing, and in fact must take one of 51 valid values:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">data</span>(precinct_validity)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">str</span>(precinct_validity[[<span class="st">'state_postal'</span>]])</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">## List of 4</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">##  $ type    : chr "character"</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">##  $ no_na   : logi TRUE</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">##  $ n_unique: num 1</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">##  $ values  : chr [1:51] "AL" "AK" "AZ" "AR" ...</a></code></pre></div>
<p>The important changes that <code>write_precincts</code> makes before writing to disk are to keep only the expected columns and normalize whitespace in character columns. If certain columns with default values are missing (e.g., <code>stage = "gen"</code>), they’ll be created.</p>
<p><code>write_precincts</code> then confirms the data meets <code>precinct validity</code> criteria:</p>
<ul>
<li>Variable type</li>
<li>Existence of <code>NA</code> values</li>
<li>Number of unique values</li>
<li>Whether all values are in a set of predefined valid values</li>
<li>The result of a custom validation function</li>
</ul>
<p>Not all criteria are defined for each variable. If any fail, we get an error; if successful, the function writes the returns to disk.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by James Dunham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
